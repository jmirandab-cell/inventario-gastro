<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Inventario - Laboratorio de Gastroenterolog√≠a HCUCH</title>

    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
</head>

<body class="bg-slate-50">

    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß™</text></svg>">

    <script src="tailwind.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        /* PARCHE DE SEGURIDAD VISUAL */
        /* Mantenemos estos estilos ya que controlan la visibilidad de tus botones */
        #details-view #save-batch-report-btn,
        #details-view #finalize-batch-btn,
        #details-view #batch-details-notes,
        #details-view label[for="batch-details-notes"],
        #item-modal #save-batch-report-btn,
        #item-modal #finalize-batch-btn {
            display: none !important;
        }

        #batch-details-modal #save-batch-report-btn,
        #batch-details-modal #finalize-batch-btn,
        #batch-details-modal #batch-details-notes,
        #batch-details-modal textarea {
            display: block !important;
        }
    </style>
    </head>

    <body class="bg-[var(--color-bg-base)] text-[var(--color-text-base)] antialiased">
        <div id="app" class="relative min-h-screen md:flex">
            <aside id="sidebar"
                class="fixed top-0 left-0 z-50 w-72 h-screen max-h-screen bg-white text-slate-800 flex flex-col shadow-2xl transition-transform duration-300 ease-in-out -translate-x-full lg:translate-x-0 lg:static overscroll-contain">

                <div class="flex-shrink-0 bg-white z-20 relative shadow-sm">

                    <header class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center text-lg">
                                üß™
                            </div>
                            <h1 id="sidebar-title" class="text-lg font-bold text-slate-700">Equipos</h1>
                        </div>

                        <button id="close-sidebar-btn"
                            class="md:hidden p-2 text-slate-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </header>

                    <div class="p-3 border-b border-slate-100 flex gap-2 flex-wrap justify-center">
                        <button id="notifications-btn" class="sidebar-icon-btn relative" title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            <span id="notification-dot"
                                class="absolute -top-1 -right-1 block h-2.5 w-2.5 rounded-full bg-red-500 ring-2 ring-white hidden"></span>
                        </button>
                        <button id="settings-btn" class="sidebar-icon-btn" title="Configuraci√≥n">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button type="button" id="btn-qr-universal" onclick="window.abrirScannerUniversal()"
                            class="bg-blue-600 text-white px-3 py-1.5 rounded-md flex items-center gap-2 text-xs font-bold shadow-md active:scale-95 transition-transform">
                            <i class="fas fa-qrcode"></i> <span>Scan</span>
                        </button>
                        <button id="sign-out-btn" class="sidebar-icon-btn text-red-500 hover:bg-red-50 border-red-100"
                            title="Cerrar Sesi√≥n">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>

                    <div class="p-3 flex gap-2">
                        <button id="multi-select-btn"
                            class="p-2 bg-blue-50 text-blue-600 rounded-md border border-blue-100 hover:bg-blue-100 transition-colors"
                            title="Selecci√≥n M√∫ltiple">
                            <i class="fas fa-check-square"></i>
                        </button>
                        <button id="export-data-btn"
                            class="hidden sm:flex flex-1 justify-center items-center gap-2 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-md text-xs font-bold hover:bg-emerald-100 transition-colors">
                            <i class="fas fa-file-csv"></i> Exportar
                        </button>
                        <button id="add-item-btn"
                            class="flex-1 bg-blue-600 text-white rounded-md flex items-center justify-center gap-2 py-2 text-xs font-bold shadow-md hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus"></i> <span id="add-btn-text" class="hidden sm:inline">A√±adir</span>
                        </button>
                    </div>

                    <div class="grid grid-cols-4 gap-1 p-2 bg-slate-50 border-y border-slate-200">
                        <button data-view="equipment" class="tab-btn active"><i class="fas fa-flask-vial"></i><span
                                class="text-[9px]">Equipos</span></button>
                        <button data-view="pipettes" class="tab-btn"><i class="fas fa-eye-dropper"></i><span
                                class="text-[9px]">Pipetas</span></button>
                        <button data-view="refrigerators" class="tab-btn"><i class="fas fa-snowflake"></i><span
                                class="text-[9px]">Refris</span></button>
                        <button data-view="maintenance" class="tab-btn"><i class="fas fa-wrench"></i><span
                                class="text-[9px]">Mant.</span></button>
                        <button data-view="testing" class="tab-btn"><i class="fas fa-vial-circle-check"></i><span
                                class="text-[9px]">Pruebas</span></button>
                        <button data-view="pipette-maintenance" class="tab-btn"><i class="fas fa-tools"></i><span
                                class="text-[9px]">Pip.Mant</span></button>
                        <button data-view="out-of-service" class="tab-btn"><i class="fas fa-ban"></i><span
                                class="text-[9px]">Baja</span></button>
                    </div>

                    <div class="p-3 bg-white border-b border-slate-100">
                        <div class="relative">
                            <input type="text" style="display:none" aria-hidden="true">
                            <input type="email" style="display:none" aria-hidden="true">

                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>

                            <input type="text" id="search-input" name="search_item_final_v2"
                                placeholder="Buscar equipo..." autocomplete="one-time-code"
                                class="w-full pl-9 pr-3 py-2 bg-slate-100 border-none rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                        </div>
                    </div>

                    <div id="selection-action-bar"
                        class="hidden p-2 bg-blue-50 border-b border-blue-100 flex justify-between items-center shadow-inner">
                        <span id="selection-count" class="text-xs font-bold text-blue-800 ml-2">0 sel.</span>
                        <div class="flex gap-2">
                            <button id="cancel-selection-btn"
                                class="bg-white text-slate-600 px-2 py-1 rounded text-xs border border-slate-200 font-bold">Cancelar</button>
                            <button id="create-batch-btn"
                                class="bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold shadow-sm">Crear
                                Lote</button>
                        </div>
                    </div>
                </div>

                <div id="item-list" class="flex-1 min-h-0 overflow-y-auto p-2 space-y-2 bg-white scroll-smooth pb-20">
                </div>

                <div id="auth-status"
                    class="flex-shrink-0 p-3 bg-slate-50 border-t border-slate-200 text-xs text-center font-medium text-slate-500">
                    Cargando usuario...
                </div>

            </aside>
            <div id="sidebar-overlay"></div>

            <style>
                .sidebar-icon-btn {
                    @apply bg-white border border-slate-200 text-slate-500 w-8 h-8 rounded-lg flex items-center justify-center hover:bg-slate-50 hover:text-blue-600 transition-colors shadow-sm;
                }

                .tab-btn {
                    @apply p-1.5 rounded-md flex flex-col items-center justify-center gap-0.5 text-slate-400 hover:text-blue-600 hover:bg-white transition-all;
                }

                .tab-btn.active {
                    @apply text-blue-600 bg-white shadow-sm ring-1 ring-slate-100 font-bold;
                }

                .tab-btn i {
                    font-size: 1.1rem;
                }
            </style>
            <main class="w-full md:w-2/3 p-4 sm:p-6 overflow-y-auto">
                <header
                    class="md:hidden p-4 bg-[var(--color-bg-surface)] rounded-xl shadow-sm border border-white/20 mb-6 flex justify-between items-center backdrop-blur-md sticky top-0 z-20">
                    <button id="hamburger-btn" class="p-2 text-[var(--color-text-base)]">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 class="text-lg font-bold text-[var(--color-text-base)]">Inventario</h2>
                    <div class="w-8"></div>
                </header>
                <input type="file" id="manual-file-input" accept="application/pdf" class="hidden">
                <div id="dashboard-view" class="animate-fade-in">
                    <div class="flex justify-between items-end mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-[var(--color-text-base)]">Dashboard</h2>
                            <p class="text-[var(--color-text-muted)] mt-1">Resumen general del laboratorio</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div id="overdue-card"
                            class="bg-white border border-red-100 p-6 rounded-2xl flex items-center gap-5 cursor-pointer hover:shadow-lg hover:border-red-200 transition-all group relative overflow-hidden">
                            <div
                                class="absolute right-0 top-0 w-24 h-24 bg-red-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                            </div>
                            <div
                                class="w-14 h-14 rounded-full bg-red-50 flex items-center justify-center text-red-500 text-2xl z-10">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="z-10">
                                <p class="text-4xl font-bold text-slate-800 mb-1" id="overdue-count">0</p>
                                <p class="text-sm font-medium text-slate-500">Mantenimientos Vencidos</p>
                            </div>
                        </div>
                        <div id="upcoming-card"
                            class="bg-white border border-amber-100 p-6 rounded-2xl flex items-center gap-5 cursor-pointer hover:shadow-lg hover:border-amber-200 transition-all group relative overflow-hidden">
                            <div
                                class="absolute right-0 top-0 w-24 h-24 bg-amber-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                            </div>
                            <div
                                class="w-14 h-14 rounded-full bg-amber-50 flex items-center justify-center text-amber-500 text-2xl z-10">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="z-10">
                                <p class="text-4xl font-bold text-slate-800 mb-1" id="upcoming-count">0</p>
                                <p class="text-sm font-medium text-slate-500">Pr√≥ximos a Vencer (30 d√≠as)</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div
                            class="bg-[var(--color-bg-surface)] p-6 rounded-2xl shadow-sm border border-slate-200/60 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-bold text-slate-800">Mantenimientos en Curso</h3>
                                    <p class="text-sm text-slate-500">Solicitudes pendientes de cierre</p>
                                </div>
                                <div class="p-2 bg-orange-50 rounded-lg text-orange-600">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                            </div>

                            <div id="dashboard-active-maintenance" class="flex flex-col gap-3 min-h-[200px]">
                                <p class="text-slate-400 text-sm italic">Cargando pendientes...</p>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 lg:col-span-2">
                            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                                <i class="fas fa-history text-blue-500"></i>
                                Actividad Reciente

                            </h3>
                            <div id="recent-activity-list" class="space-y-3 max-h-64 overflow-y-auto pr-2">
                                <div class="animate-pulse flex space-x-4">
                                    <div class="rounded-full bg-slate-200 h-10 w-10"></div>
                                    <div class="flex-1 space-y-2 py-1">
                                        <div class="h-2 bg-slate-200 rounded"></div>
                                        <div class="space-y-3">
                                            <div class="grid grid-cols-3 gap-4">
                                                <div class="h-2 bg-slate-200 rounded col-span-2"></div>
                                                <div class="h-2 bg-slate-200 rounded col-span-1"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="details-view" class="hidden animate-fade-in p-1">
                    <div
                        class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-emerald-400">
                        </div>
                        <div class="flex flex-col lg:flex-row gap-8 mt-4">
                            <div class="flex-shrink-0 flex flex-col gap-4 items-center lg:items-start">
                                <div id="details-image-container" class="relative group">
                                    <img id="details-image"
                                        class="w-72 h-72 object-contain rounded-xl border border-slate-100 bg-slate-50 p-4"
                                        src="">
                                    <div
                                        class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors rounded-xl pointer-events-none">
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1 w-full min-w-0">
                                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-6">
                                    <div>
                                        <div class="flex items-center gap-3 mb-2">
                                            <h2 id="details-name"
                                                class="text-3xl font-bold text-slate-800 tracking-tight">
                                            </h2>
                                            <button id="gemini-summary-btn"
                                                class="text-purple-600 bg-purple-50 hover:bg-purple-100 p-2 rounded-lg transition-colors"
                                                title="Resumen IA">
                                                <i class="fas fa-magic"></i>
                                            </button>
                                        </div>
                                        <div id="details-subtext-container"
                                            class="flex flex-wrap gap-2 text-sm text-slate-500"></div>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <button id="view-audit-log-btn"
                                            class="btn-action bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 p-2.5 rounded-lg shadow-sm transition-all"
                                            title="Historial">
                                            <i class="fas fa-history text-lg"></i>
                                        </button>
                                        <button id="generate-qr-btn"
                                            class="btn-action bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 p-2.5 rounded-lg shadow-sm transition-all"
                                            title="QR">
                                            <i class="fas fa-qrcode text-lg"></i>
                                        </button>
                                        <div class="w-px bg-slate-200 h-10 mx-1 hidden md:block"></div>
                                        <button id="manual-btn"
                                            class="btn-action bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 p-2.5 rounded-lg shadow-sm transition-all"
                                            title="Manuales">
                                            <i class="fas fa-book text-lg"></i>
                                        </button>

                                        <button id="reception-docs-btn"
                                            class="btn-action bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 p-2.5 rounded-lg shadow-sm transition-all"
                                            title="Recepci√≥n">
                                            <i class="fas fa-file-invoice-dollar text-lg"></i>
                                        </button>

                                        <button id="inserts-btn"
                                            class="btn-action bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 p-2.5 rounded-lg shadow-sm transition-all"
                                            title="Insertos">
                                            <i class="fas fa-vial text-lg"></i>
                                        </button>
                                        <button id="convert-to-inventory-btn"
                                            class="hidden bg-emerald-50 hover:bg-emerald-100 text-emerald-600 border border-emerald-200 font-bold py-2 px-4 rounded-lg transition-all items-center gap-2"
                                            title="Convertir">
                                            <i class="fas fa-check-circle"></i>
                                            Validar

                                        </button>
                                        <div class="w-px bg-slate-200 h-10 mx-1 hidden md:block"></div>
                                        <button id="edit-item-btn"
                                            class="bg-amber-50 text-amber-600 border border-amber-200 hover:bg-amber-100 p-2.5 rounded-lg transition-all shadow-sm"
                                            title="Editar">
                                            <i class="fas fa-edit text-lg"></i>
                                        </button>
                                        <button id="delete-item-btn"
                                            class="bg-red-50 text-red-600 border border-red-200 hover:bg-red-100 p-2.5 rounded-lg transition-all shadow-sm"
                                            title="Eliminar">
                                            <i class="fas fa-trash text-lg"></i>
                                        </button>
                                    </div>
                                </div>
                                <div id="batch-info-banner"
                                    class="hidden mb-6 bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-r-lg text-sm flex justify-between items-center shadow-sm">
                                    <span class="flex items-center gap-2 font-medium">
                                        <i class="fas fa-layer-group"></i>
                                        Parte del <strong id="batch-id-banner"></strong>
                                    </span>
                                    <button id="view-batch-btn"
                                        class="font-bold hover:underline bg-white px-3 py-1 rounded border border-blue-200 shadow-sm text-blue-600">Ver
                                        Lote ‚Üí</button>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6">
                                    <div class="bg-slate-50 border border-slate-200 p-4 rounded-xl text-center">
                                        <p class="text-xs text-slate-400 uppercase font-bold mb-1">Estado Actual</p>
                                        <p id="details-status" class="text-lg font-bold text-slate-800">--</p>
                                    </div>
                                    <div class="bg-slate-50 border border-slate-200 p-4 rounded-xl text-center">
                                        <p id="details-date1-label"
                                            class="text-xs text-slate-400 uppercase font-bold mb-1">
                                            √öltimo Mantenimiento</p>
                                        <p id="details-date1-value" class="text-lg font-bold text-slate-700">--</p>
                                    </div>
                                    <div class="bg-slate-50 border border-slate-200 p-4 rounded-xl text-center">
                                        <p id="details-date2-label"
                                            class="text-xs text-slate-400 uppercase font-bold mb-1">
                                            Pr√≥ximo Mantenimiento</p>
                                        <p id="details-date2-value" class="text-lg font-bold text-slate-700">--</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <details id="maintenance-tracking-section"
                            class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden group">
                            <summary
                                class="p-5 cursor-pointer flex justify-between items-center hover:bg-slate-50 transition-colors select-none">
                                <h3
                                    class="text-lg font-bold text-slate-700 group-open:text-blue-600 flex items-center gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                        <i class="fas fa-tasks"></i>
                                    </div>
                                    Seguimiento de Solicitudes

                                </h3>
                                <i
                                    class="fas fa-chevron-down text-slate-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="p-5 border-t border-slate-100 bg-slate-50/50">
                                <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                                    <button id="generate-maintenance-request-btn"
                                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md shadow-blue-500/20 transition-all flex items-center gap-2">
                                        <i class="fas fa-plus"></i>
                                        Nueva Solicitud

                                    </button>
                                    <div class="flex gap-2">
                                        <select id="maintenance-filter"
                                            class="bg-white border border-slate-300 rounded-lg p-2 text-sm text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="all">Todas</option>
                                            <option value="open">Abiertas</option>
                                            <option value="closed">Cerradas</option>
                                        </select>
                                        <select id="maintenance-sort"
                                            class="bg-white border border-slate-300 rounded-lg p-2 text-sm text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="desc">M√°s Recientes</option>
                                            <option value="asc">M√°s Antiguas</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="maintenance-list" class="space-y-4"></div>
                                <div id="no-maintenance-tickets-view" class="hidden text-center py-8 text-slate-400">
                                    <p>No hay solicitudes.</p>
                                </div>
                                <div id="maintenance-pagination-controls"
                                    class="hidden justify-between items-center mt-6 text-sm text-slate-500"></div>
                            </div>
                        </details>
                        <details id="reports-section"
                            class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden group">
                            <summary
                                class="p-5 cursor-pointer flex justify-between items-center hover:bg-slate-50 transition-colors select-none">
                                <h3
                                    class="text-lg font-bold text-slate-700 group-open:text-emerald-600 flex items-center gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-emerald-50 text-emerald-500 flex items-center justify-center">
                                        <i class="fas fa-file-medical"></i>
                                    </div>
                                    Informes de Mantenimiento

                                </h3>
                                <i
                                    class="fas fa-chevron-down text-slate-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="p-5 border-t border-slate-100 bg-slate-50/50">
                                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                                    <button id="add-report-btn"
                                        class="w-full sm:w-auto bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md shadow-emerald-500/20 transition-all flex items-center justify-center gap-2">
                                        <i class="fas fa-plus"></i>
                                        A√±adir Informe

                                    </button>
                                    <div class="flex gap-2 flex-wrap justify-end">
                                        <select id="report-type-filter"
                                            class="bg-white border border-slate-300 p-2 rounded-lg text-sm text-slate-700">
                                            <option value="all">Todos</option>
                                            <option value="Mantenimiento Preventivo">Preventivo</option>
                                            <option value="Mantenimiento Correctivo">Correctivo</option>
                                        </select>
                                        <input type="date" id="report-date-from"
                                            class="bg-white border border-slate-300 p-2 rounded-lg text-sm text-slate-700">
                                        <input type="date" id="report-date-to"
                                            class="bg-white border border-slate-300 p-2 rounded-lg text-sm text-slate-700">
                                        <button id="clear-report-filters-btn"
                                            class="text-xs text-slate-500 hover:text-emerald-600 underline px-2">Limpiar</button>
                                    </div>
                                </div>
                                <div id="reports-list" class="space-y-3"></div>
                                <div id="no-reports-view" class="hidden text-center py-8 text-slate-400">
                                    <p>No hay informes.</p>
                                </div>
                                <div id="reports-pagination-controls"
                                    class="hidden justify-between mt-4 text-sm text-slate-500"></div>
                            </div>
                        </details>
                    </div>
                </div>
            </main>
        </div>
        <div id="notifications-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Alertas de Mantenimiento</h2>
                    <button id="close-notifications-modal"
                        class="text-[var(--color-text-muted)] hover:text-slate-800 text-3xl">&times;</button>
                </div>
                <div id="notifications-list" class="space-y-3"></div>
            </div>
        </div>
        <div id="gemini-summary-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-2xl p-8 m-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-slate-800">Resumen IA del Historial ‚ú®</h2>
                    <button id="close-gemini-summary-modal"
                        class="text-[var(--color-text-muted)] hover:text-slate-800">&times;</button>
                </div>
                <div id="gemini-summary-content" class="text-slate-600 space-y-4"></div>
            </div>
        </div>
        <div id="manuals-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">Gestionar Manuales</h2>
                <div class="mb-6">
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Subir Nuevos Manuales</h3>
                    <form id="add-manual-form" class="space-y-4">
                        <div id="manual-dropzone" class="dropzone">
                            <i class="fas fa-file-upload text-3xl text-slate-400 dropzone-icon"></i>
                            <p class="text-[var(--color-text-muted)] mt-2 dropzone-text">Arrastra los archivos aqu√≠ o
                                usa
                                los botones</p>
                            <div class="flex items-center gap-2 mt-3">
                                <input type="file" id="new-manual-file" accept="application/pdf,image/*" class="hidden"
                                    multiple>
                                <button type="button" id="manual-file-gallery-btn"
                                    onclick="window.abrirSelectorArchivos()"
                                    class="flex-1 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 font-semibold py-2 px-4 rounded-lg">
                                    Seleccionar Archivos
                                </button>
                                <button type="button" id="manual-file-camera-btn"
                                    onclick="window.abrirScannerUniversal()"
                                    class="p-2 bg-[var(--color-primary)] hover:opacity-80 text-white rounded-lg"
                                    title="Usar C√°mara">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <div id="manual-files-list" class="mt-2 space-y-2 text-sm max-h-32 overflow-y-auto"></div>
                        <button type="submit" id="submit-manual-btn-"
                            class="w-full bgblue-600 hover:bg-white text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">Subir
                            Manuales</button>
                    </form>
                </div>
                <div>
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Manuales Existentes</h3>
                    <div id="manuals-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
                <div class="flex justify-end mt-8">
                    <button type="button" id="close-manuals-modal"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="inserts-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">Gestionar Insertos/T√©cnicas</h2>
                <div class="mb-6">
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Subir Nuevos Insertos</h3>
                    <form id="add-insert-form" class="space-y-4">
                        <div id="insert-dropzone" class="dropzone">
                            <i class="fas fa-file-upload text-3xl text-slate-400 dropzone-icon"></i>
                            <p class="text-[var(--color-text-muted)] mt-2 dropzone-text">Arrastra los archivos aqu√≠ o
                                usa
                                los botones</p>
                            <div class="flex items-center gap-2 mt-3">
                                <input type="file" id="new-insert-file" accept="application/pdf,image/*" class="hidden"
                                    multiple>
                                <button type="button" id="insert-file-gallery-btn"
                                    class="flex-1 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 font-semibold py-2 px-4 rounded-lg">Seleccionar
                                    Archivos</button>
                                <button type="button" id="insert-file-camera-btn"
                                    class="p-2 bg-[var(--color-primary)] hover:opacity-80 text-white rounded-lg"
                                    title="Usar C√°mara">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <div id="insert-files-list" class="mt-2 space-y-2 text-sm max-h-32 overflow-y-auto"></div>
                        <button type="submit" id="submit-insert-btn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">
                            Subir Insertos
                        </button>
                    </form>
                </div>
                <div>
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Insertos Existentes</h3>
                    <div id="inserts-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
                <div class="flex justify-end mt-8">
                    <button type="button" id="close-inserts-modal"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="add-ticket-step-modal"
            class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[60] backdrop-blur-sm transition-opacity">
            <div
                class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden transform scale-100 transition-all">

                <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-clipboard-list text-blue-600"></i>
                        Actualizar Estado del Ticket
                    </h3>
                    <button type="button"
                        onclick="document.getElementById('add-ticket-step-modal').classList.add('hidden')"
                        class="text-gray-400 hover:text-red-500 transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-50">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="add-ticket-step-form" class="p-6 space-y-5">
                    <input type="hidden" id="ticket-id-input">

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Nuevo Estado</label>
                        <select id="ticket-step-status" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all text-gray-700 bg-white">

                            <option value="Solicitud Enviada a Equipos M√©dicos">Solicitud Enviada a Equipos M√©dicos
                            </option>
                            <option value="Esperando Cotizaci√≥n">Esperando Cotizaci√≥n</option>
                            <option value="Aceptar Cotizaci√≥n">Aceptar Cotizaci√≥n</option>
                            <option value="Orden de Compra Realizada">Orden de Compra Realizada</option>
                            <option value="A la espera de Mantenci√≥n">A la espera de Mantenci√≥n</option>

                            <option value="Mantenci√≥n Realizada" class="font-bold text-green-700">‚úÖ Mantenci√≥n Realizada
                                (Finalizar)</option>
                            <option value="Equipo dado de baja" class="font-bold text-red-700">‚õî Equipo dado de baja
                            </option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Fecha del Paso</label>
                        <input type="date" id="ticket-step-date" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-gray-700">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Notas (Opcional)</label>
                        <textarea id="ticket-step-notes" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none text-gray-700 placeholder-gray-400"
                            placeholder="Ej: N¬∞ de orden de compra, nombre del t√©cnico..."></textarea>
                    </div>

                    <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
                        <button type="button" id="cancel-add-step-modal"
                            onclick="document.getElementById('add-ticket-step-modal').classList.add('hidden')"
                            class="px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-all">
                            Cancelar
                        </button>

                        <button type="submit"
                            class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                            <i class="fas fa-save"></i>
                            Guardar Paso
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div id="copy-data-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-2xl p-8 m-4">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Datos Generados</h2>
                <p class="text-[var(--color-text-muted)] mb-6">El archivo Word se est√° descargando. Copia estos datos y
                    p√©galos en el documento.</p>
                <textarea id="copy-data-textarea"
                    class="w-full h-64 p-3 border border-slate-300 rounded-lg bg-slate-50 text-slate-800 font-mono text-sm"
                    readonly></textarea>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="copy-data-btn"
                        class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-6 rounded-lg">Copiar
                        Datos</button>
                    <button type="button" id="close-copy-data-modal"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="item-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] text-slate-800 rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <h2 id="item-modal-title" class="text-2xl font-bold text-slate-800 mb-6"></h2>
                <form id="item-form">
                    <input type="hidden" id="item-id">
                    <input type="hidden" id="item-type">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">Foto del
                                √çtem</label>
                            <div class="mt-1 flex items-center gap-4">
                                <img id="image-preview"
                                    class="h-20 w-20 rounded-lg object-cover bg-slate-100 border border-slate-200"
                                    src="https://placehold.co/80x80/e2e8f0/64748b?text=Foto">
                                <div class="flex-1 flex items-center gap-2" id="image-buttons-container">
                                    <input type="file" id="item-image" accept="image/*" class="hidden">
                                    <button type="button" id="item-image-gallery-btn"
                                        class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-bold py-2 px-4 rounded-lg border border-slate-300">Galer√≠a
                                    </button>
                                    <button type="button" id="item-image-camera-btn"
                                        class="flex-1 bg-[var(--color-primary)] hover:opacity-80 text-white text-sm font-bold py-2 px-4 rounded-lg">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="image-upload-progress-container" class="hidden space-y-1 mt-2">
                                <div class="flex justify-between text-sm font-medium">
                                    <span class="text-[var(--color-text-muted)]">Subiendo imagen...</span>
                                    <span id="image-upload-progress-text">0%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div id="image-upload-progress-bar" class="progress-bar"></div>
                                </div>
                            </div>
                        </div>
                        <input type="text" id="item-name" placeholder="Nombre"
                            class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                        <div>
                            <label for="item-room" class="block text-sm font-medium text-[var(--color-text-muted)]">Sala
                                o
                                Ubicaci√≥n</label>
                            <select id="item-room"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1"
                                required>
                                <option value="" disabled selected>Cargando salas...</option>
                            </select>
                        </div>
                        <div>
                            <label for="item-ownership"
                                class="block text-sm font-medium text-[var(--color-text-muted)]">Propiedad</label>
                            <select id="item-ownership"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1"
                                required>
                                <option value="HCUCH">HCUCH</option>
                                <option value="Comodato">Comodato</option>
                            </select>
                        </div>
                        <div id="item-loan-company-container" class="hidden">
                            <label for="item-loan-company"
                                class="block text-sm font-medium text-[var(--color-text-muted)]">Empresa de
                                Comodato</label>
                            <input type="text" id="item-loan-company" placeholder="Nombre de la empresa"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">N¬∞ Interno
                                Inventario</label>
                            <input type="text" id="item-internal-id" placeholder="Ej: INV-2025-001"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                        </div>
                        <div id="general-fields" class="space-y-4">
                            <input type="text" id="item-model" placeholder="Modelo"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <input type="text" id="item-serial" placeholder="N√∫mero de Serie"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <div id="maintenance-fields-container">
                                <label class="block text-sm font-medium text-[var(--color-text-muted)]">√öltimo
                                    Mantenimiento</label>
                                <input type="date" id="item-last-maintenance"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                                <label class="block text-sm font-medium text-[var(--color-text-muted)] mt-4">Pr√≥ximo
                                    Mantenimiento</label>
                                <input type="date" id="item-next-maintenance"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">Frecuencia de
                                Mantenci√≥n / Calibraci√≥n</label>
                            <select id="item-frequency"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="No aplica">No aplica (Solo cuando falla)</option>
                                <option value="Mensual">Mensual (Cada mes)</option>
                                <option value="Trimestral">Trimestral (Cada 3 meses)</option>
                                <option value="Semestral">Semestral (Cada 6 meses)</option>
                                <option value="Anual">Anual (Cada 1 a√±o)</option>
                            </select>
                        </div>
                        <div id="pipette-fields" class="space-y-4">
                            <input type="text" id="item-brand" placeholder="Marca"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <input type="text" id="pipette-serial" placeholder="N√∫mero de Serie"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <input type="text" id="item-volume" placeholder="Rango de Volumen (ej. 100-1000 ¬µL)"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <div>
                                <label class="block text-sm font-medium text-[var(--color-text-muted)]">√öltima
                                    Calibraci√≥n</label>
                                <input type="date" id="item-last-calibration"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--color-text-muted)]">Pr√≥xima
                                    Calibraci√≥n</label>
                                <input type="date" id="item-next-calibration"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                            </div>
                        </div>
                        <div id="refrigerator-fields" class="space-y-4">
                            <input type="text" id="refrigerator-brand" placeholder="Marca"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <input type="text" id="refrigerator-model" placeholder="Modelo"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <input type="text" id="refrigerator-temperature"
                                placeholder="Temperatura de Operaci√≥n (ej. -20¬∞C)"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800">
                            <div>
                                <label class="block text-sm font-medium text-[var(--color-text-muted)]">√öltimo
                                    Mantenimiento</label>
                                <input type="date" id="refrigerator-last-maintenance"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--color-text-muted)]">Pr√≥ximo
                                    Mantenimiento</label>
                                <input type="date" id="refrigerator-next-maintenance"
                                    class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1">
                            </div>
                        </div>
                        <select id="item-status"
                            class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                            <option value="Operativo">Operativo</option>
                            <option value="En Mantenimiento">En Mantenimiento</option>
                            <option value="Fuera de Servicio">Fuera de Servicio</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-4 mt-8 pt-4 border-t border-slate-100">
                        <button type="button" id="cancel-item-modal"
                            class="bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-2 px-6 rounded-lg transition-colors">Cancelar
                        </button>
                        <button type="submit" id="submit-item-btn"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded-lg shadow-md shadow-blue-500/20 transition-all transform active:scale-95">Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div id="report-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] text-slate-800 rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">A√±adir Nuevo Informe</h2>
                <form id="report-form">
                    <div class="space-y-4">
                        <div>
                            <label for="report-type"
                                class="block text-sm font-medium text-[var(--color-text-muted)]">Tipo
                                de Informe</label>
                            <select id="report-type"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1"
                                required>
                                <option value="Mantenimiento Preventivo">Mantenimiento Preventivo</option>
                                <option value="Mantenimiento Correctivo">Mantenimiento Correctivo</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--color-text-muted)]">Fecha del
                                Informe</label>
                            <input type="date" id="report-date"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800 mt-1"
                                required>
                        </div>
                        <input type="text" id="report-technician" placeholder="Nombre del T√©cnico"
                            class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                        <textarea id="report-findings" placeholder="Observaciones y Hallazgos..."
                            class="w-full p-3 bg-white border border-slate-300 rounded-lg h-32 text-slate-800"
                            required></textarea>
                        <div>
                            <label class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">Adjuntar
                                Archivos</label>
                            <div id="report-dropzone" class="dropzone">
                                <i class="fas fa-file-upload text-3xl text-slate-400 dropzone-icon"></i>
                                <p class="text-[var(--color-text-muted)] mt-2 dropzone-text">Arrastra los archivos aqu√≠
                                    o
                                    usa los botones</p>
                                <div class="flex items-center gap-2 mt-3">
                                    <input type="file" id="report-pdf"
                                        accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx" class="hidden" multiple>
                                    <button type="button" id="report-file-gallery-btn"
                                        class="flex-1 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 font-semibold py-2 px-4 rounded-lg border border-slate-300">Seleccionar
                                        Archivos</button>
                                    <button type="button" id="report-file-camera-btn"
                                        class="p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition-all active:scale-95 flex items-center justify-center"
                                        title="Usar C√°mara">
                                        <i class="fas fa-camera text-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="report-files-list" class="mt-2 space-y-2 text-sm max-h-32 overflow-y-auto"></div>
                        </div>
                        <div id="upload-progress-container" class="hidden space-y-1">
                            <div class="flex justify-between text-sm font-medium">
                                <span class="text-[var(--color-text-muted)]">Subiendo archivos...</span>
                                <span id="upload-progress-text">0%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div id="upload-progress-bar" class="progress-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end items-center gap-4 mt-8 pt-4 border-t border-slate-100">
                        <button type="button" id="cancel-report-modal"
                            class="bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-2 px-6 rounded-lg transition-colors">Cancelar
                        </button>
                        <button type="submit" id="submit-report-btn"
                            class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-8 rounded-lg shadow-md transition-all active:scale-95">Guardar
                            Informe
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div id="reception-docs-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">Documentos de Recepci√≥n</h2>
                <div class="mb-6">
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Subir Documentos</h3>
                    <form id="add-reception-doc-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">Fecha del
                                Documento</label>
                            <input type="date" id="reception-doc-date"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                        </div>
                        <div id="reception-dropzone" class="dropzone">
                            <i class="fas fa-cloud-upload-alt text-3xl text-slate-400 dropzone-icon"></i>
                            <p class="text-[var(--color-text-muted)] mt-2 dropzone-text">Arrastra archivos aqu√≠</p>
                            <div class="flex items-center gap-2 mt-3">
                                <input type="file" id="new-reception-file" accept="application/pdf,image/*"
                                    class="hidden" multiple>
                                <button type="button" id="reception-file-gallery-btn"
                                    class="flex-1 text-sm text-slate-600 bg-slate-100 hover:bg-slate-200 font-semibold py-2 px-4 rounded-lg">Seleccionar</button>
                                <button type="button" id="reception-file-camera-btn"
                                    class="p-2 bg-[var(--color-primary)] hover:opacity-80 text-white rounded-lg"
                                    title="Usar C√°mara">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <div id="reception-files-list" class="mt-2 space-y-2 text-sm max-h-32 overflow-y-auto"></div>
                        <button type="submit" id="submit-reception-doc-btn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">Guardar
                            Documentos</button>
                    </form>
                </div>
                <div>
                    <h3
                        class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                        Historial</h3>
                    <div id="reception-docs-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
                <div class="flex justify-end mt-8">
                    <button type="button" id="close-reception-docs-modal"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="settings-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div
                class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-md p-8 m-4 max-h-[90vh] flex flex-col">
                <h2 class="text-2xl font-bold text-slate-800 mb-6 flex-shrink-0">Configuraci√≥n</h2>
                <div class="flex-1 overflow-y-auto -mr-4 pr-4">
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Gestionar Salas</h3>
                        <div class="mb-4">
                            <form id="add-room-form" class="flex gap-2">
                                <input type="text" id="new-room-name" placeholder="Nombre de la nueva sala"
                                    class="flex-1 p-3 bg-white border border-slate-300 rounded-lg text-slate-800"
                                    required>
                                <button type="submit"
                                    class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-4 rounded-lg">A√±adir</button>
                            </form>
                        </div>
                        <div id="rooms-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                    </div>
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Lotes de Calibraci√≥n</h3>
                        <p class="text-sm text-[var(--color-text-muted)] mb-2">Haz clic en un lote para ver sus detalles
                            y
                            subir el informe.</p>
                        <div id="batch-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                    </div>
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Apariencia</h3>
                        <form id="update-theme-form" class="space-y-4">
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-medium text-[var(--color-text-muted)]">Modo</label>
                                <div class="flex bg-slate-100 rounded-lg p-1">
                                    <button type="button" id="theme-dark-btn"
                                        class="px-3 py-1 rounded-md text-sm font-medium transition-all"
                                        onclick="setThemeMode('dark')">
                                        <i class="fas fa-moon"></i>
                                    </button>
                                    <button type="button" id="theme-light-btn"
                                        class="px-3 py-1 rounded-md text-sm font-medium transition-all"
                                        onclick="setThemeMode('light')">
                                        <i class="fas fa-sun"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="primary-color-picker"
                                    class="text-sm font-medium text-[var(--color-text-muted)]">Color Principal</label>
                                <div class="flex items-center gap-2">
                                    <input type="color" id="primary-color-picker"
                                        class="h-10 w-20 p-1 bg-slate-100 border border-slate-300 rounded cursor-pointer"
                                        value="#0ea5e9">
                                    <button type="submit"
                                        class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-3 rounded-lg text-sm">Aplicar</button>
                                </div>
                            </div>
                            <p class="text-xs text-[var(--color-text-muted)]">La configuraci√≥n se guarda en este
                                dispositivo.</p>
                        </form>
                    </div>
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Papelera de Reciclaje</h3>
                        <div id="trash-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                    </div>
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Correlativo Mantenci√≥n</h3>
                        <form id="update-counter-form" class="space-y-2">
                            <p class="text-sm text-[var(--color-text-muted)]">
                                A√±o actual: <span id="counter-year"></span>
                            </p>
                            <div class="flex items-center gap-2">
                                <label for="next-counter-value"
                                    class="text-sm font-medium text-[var(--color-text-muted)]">Pr√≥ximo N¬∞:</label>
                                <input type="number" id="next-counter-value" inputmode="numeric"
                                    class="w-24 p-2 bg-white border border-slate-300 rounded-lg text-slate-800">
                                <button type="submit"
                                    class="bg-[var(--color-info)] hover:opacity-80 text-white font-bold py-2 px-3 rounded-lg">Guardar</button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <h3
                            class="text-lg font-semibold text-slate-700 mb-3 border-b border-[var(--color-border-muted)] pb-2">
                            Cambiar Contrase√±a</h3>
                        <form id="change-password-form" class="space-y-4">
                            <input type="password" id="current-password" placeholder="Contrase√±a Actual"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                            <input type="password" id="new-password" placeholder="Nueva Contrase√±a"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                            <input type="password" id="confirm-new-password" placeholder="Confirmar Nueva Contrase√±a"
                                class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                            <button type="submit"
                                class="w-full bg-[var(--color-info)] hover:opacity-80 text-white font-bold py-2 px-4 rounded-lg">Cambiar
                                Contrase√±a</button>
                        </form>
                    </div>
                </div>
                <div class="mt-6 border-t border-slate-200 pt-4 w-full">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Herramientas de Gesti√≥n</h3>
                    <button type="button" onclick="window.openPrintModal()"
                        class="w-full flex justify-center items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-sm">
                        <i class="fas fa-barcode"></i>
                        Imprimir Etiquetas
                    </button>
                    <p class="text-xs text-slate-500 mt-2 text-center">Genera c√≥digos de barra por categor√≠a.</p>
                </div>
                <div class="flex justify-end mt-8 flex-shrink-0">
                    <button type="button" id="close-settings-modal"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="password-modal" class="fixed inset-0 z-[70] items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-sm p-8 m-4">
                <h2 class="text-xl font-bold text-slate-800 mb-4">Confirmaci√≥n Requerida</h2>
                <p class="text-[var(--color-text-muted)] mb-4">Por seguridad, por favor ingresa la contrase√±a para
                    continuar.</p>
                <form id="password-form">
                    <div class="space-y-4">
                        <input type="password" id="password-input"
                            class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800" required>
                        <p id="password-error" class="text-[var(--color-danger)] text-sm hidden">Contrase√±a incorrecta.
                        </p>
                    </div>
                    <div class="flex justify-end gap-4 mt-6">
                        <button type="button" id="cancel-password-modal"
                            class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cancelar</button>
                        <button type="submit"
                            class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-6 rounded-lg">Confirmar</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="confirm-modal" class="fixed inset-0 z-[60] items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-sm p-8 m-4 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-[var(--color-warning)] mb-4"></i>
                <h2 id="confirm-title" class="text-xl font-bold text-slate-800 mb-2"></h2>
                <p id="confirm-message" class="text-[var(--color-text-muted)] mb-6"></p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-confirm-btn"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cancelar</button>
                    <button id="confirm-action-btn"
                        class="bg-[var(--color-danger)] hover:opacity-80 text-white font-bold py-2 px-6 rounded-lg">Confirmar</button>
                </div>
            </div>
        </div>
        <div id="maintenance-type-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-sm p-8 m-4 text-center">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Tipo de Mantenimiento</h2>
                <p class="text-[var(--color-text-muted)] mb-6">Selecciona el tipo de mantenimiento para la nueva
                    solicitud.
                </p>

                <div class="flex flex-col gap-4">
                    <button onclick="generateMaintenanceRequest('Preventivo')" id="preventive-maintenance-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg w-full shadow-md transition-all">
                        Mantenimiento Preventivo
                    </button>

                    <button onclick="generateMaintenanceRequest('Correctivo')" id="corrective-maintenance-btn"
                        class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 px-6 rounded-lg w-full">
                        Mantenimiento Correctivo
                    </button>

                    <button id="cancel-maintenance-type-btn"
                        class="mt-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
        <div id="qr-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-sm p-8 m-4 text-center">
                <h2 id="qr-item-name" class="text-xl font-bold text-slate-800 mb-4"></h2>
                <div id="qr-code-container" class="p-4 bg-white rounded-lg inline-block"></div>
                <div class="flex justify-center gap-4 mt-6">
                    <button id="print-qr-btn"
                        class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-6 rounded-lg">Imprimir</button>
                    <button id="close-qr-modal-btn"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cerrar</button>
                </div>
            </div>
        </div>
        <div id="scanner-container" class="hidden justify-center items-center">
            <video id="scanner-video" playsinline></video>
            <button id="close-scanner-btn" class="absolute top-4 right-4 text-white text-3xl">&times;</button>
        </div>
        <div id="create-batch-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
            <div class="bg-[var(--color-bg-surface)] rounded-xl shadow-2xl w-full max-w-md p-8 m-4">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Crear Lote de Calibraci√≥n</h2>
                <p class="text-[var(--color-text-muted)] mb-4">Se crear√° un lote con las siguientes pipetas:</p>
                <div id="batch-pipette-list" class="max-h-40 overflow-y-auto space-y-2 mb-4"></div>
                <textarea id="batch-notes" class="w-full p-3 bg-white border border-slate-300 rounded-lg text-slate-800"
                    placeholder="Notas adicionales para el lote (opcional)"></textarea>
                <div class="flex justify-end gap-4 mt-6">
                    <button id="cancel-create-batch-btn"
                        class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg">Cancelar</button>
                    <button id="confirm-create-batch-btn"
                        class="bg-[var(--color-primary)] hover:opacity-80 text-white font-bold py-2 px-6 rounded-lg">Confirmar
                        y Crear</button>
                </div>
            </div>
        </div>

        <div id="batch-details-modal"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm">

            <div
                class="bg-slate-900 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-slate-700 overflow-hidden">

                <div class="bg-slate-800 p-4 border-b border-slate-700 flex justify-between items-center">
                    <div>
                        <h3 id="batch-details-title" class="text-xl font-bold text-white">Detalles del Lote</h3>
                        <p id="batch-details-status" class="text-sm font-bold text-blue-400 mt-1">CARGANDO...</p>
                    </div>
                    <button
                        onclick="document.getElementById('batch-details-modal').classList.add('hidden'); document.getElementById('batch-details-modal').classList.remove('flex');"
                        class="text-slate-400 hover:text-white transition-colors p-2">
                        <i class="fas fa-times fa-lg"></i>
                    </button>
                </div>

                <div class="p-6 overflow-y-auto flex-1 space-y-6">

                    <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                        <h4 class="text-sky-400 font-bold mb-3 flex items-center">
                            <i class="fas fa-vials mr-2"></i> Pipetas en este Lote
                        </h4>
                        <div id="batch-details-pipette-list"
                            class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2">
                        </div>
                    </div>

                    <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                        <h4 class="text-yellow-400 font-bold mb-3 flex items-center">
                            <i class="fas fa-clipboard-list mr-2"></i> Datos del Informe (Aplica a todas)
                        </h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-slate-400 text-sm mb-1">Notas T√©cnicas / Hallazgos</label>
                                <textarea id="batch-details-notes" rows="4"
                                    class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:border-blue-500 outline-none resize-none"
                                    placeholder="Ej: Calibraci√≥n realizada seg√∫n norma ISO..."></textarea>
                            </div>

                            <div>
                                <label class="block text-slate-400 text-sm mb-1">Certificado √önico (PDF/Img)</label>

                                <div id="batch-attachments-list" class="mb-3 space-y-1 min-h-[40px]"></div>

                                <div class="flex gap-2">
                                    <input type="file" id="batch-file-input" class="hidden"
                                        accept=".pdf,.doc,.docx,.jpg,.png">
                                    <button onclick="document.getElementById('batch-file-input').click()"
                                        class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 px-3 rounded border border-slate-600 transition-colors text-sm flex items-center justify-center gap-2">
                                        <i class="fas fa-paperclip"></i> Adjuntar Archivo
                                    </button>
                                </div>
                                <p class="text-xs text-slate-500 mt-2">
                                    * Al subir un archivo aqu√≠, se copiar√° autom√°ticamente al historial de CADA pipeta
                                    al
                                    finalizar.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 p-4 border-t border-slate-700 flex justify-between items-center">

                    <button id="btn-delete-batch-modal"
                        class="text-red-400 hover:text-red-300 hover:bg-red-900/20 px-4 py-2 rounded transition-colors font-bold border border-transparent">
                        <i class="fas fa-trash-alt mr-2"></i> Eliminar Lote
                    </button>

                    <div class="flex gap-3">
                        <button id="save-batch-report-btn"
                            class="text-slate-300 hover:text-white px-4 py-2 font-bold transition-colors border border-slate-600 rounded hover:bg-slate-700">
                            <i class="fas fa-save mr-2"></i> Guardar Notas
                        </button>
                        <button id="finalize-batch-btn"
                            class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded shadow-lg shadow-green-900/50 transition-all hover:scale-105 border border-green-500">
                            <i class="fas fa-check-circle mr-2"></i> FINALIZAR LOTE
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <template id="notification-item-template">
            <div
                class="notification-item flex items-center justify-between p-3 rounded-lg cursor-pointer hover:bg-[var(--color-bg-muted)]">
                <div>
                    <p class="font-semibold text-slate-800 item-name"></p>
                    <p class="text-sm text-[var(--color-text-muted)] item-details"></p>
                </div>
                <p class="text-sm font-bold item-due-date text-right"></p>
            </div>
        </template>

        <template id="manual-item-template">
            <div class="flex justify-between items-center bg-[var(--color-bg-muted)] p-3 rounded-lg">
                <span class="manual-name text-[var(--color-text-base)] truncate"></span>
                <div class="flex items-center gap-2 flex-shrink-0">
                    <a href="#" target="_blank" rel="noopener noreferrer"
                        class="view-manual-btn text-[var(--color-primary)] hover:opacity-80" title="Ver Manual">
                        <i class="fas fa-eye"></i>
                    </a>
                    <button class="delete-manual-btn text-[var(--color-danger)] hover:opacity-80" aria-label="Eliminar"
                        title="Eliminar Manual">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </template>

        <template id="maintenance-ticket-template">
            <div class="bg-[var(--color-bg-base)] p-4 rounded-lg shadow-sm border border-[var(--color-border-muted)]">
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <h4 class="font-bold text-[var(--color-info)] flex items-center gap-2">
                            <span class="ticket-title"></span>
                            <span class="ticket-type-badge hidden text-xs font-medium px-2 py-0.5 rounded-full"></span>
                        </h4>
                        <p class="text-sm text-[var(--color-text-muted)] mt-1">
                            Estado actual: <span class="font-semibold ticket-status"></span>
                        </p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button
                            class="toggle-ticket-history-btn text-sm text-[var(--color-primary)] hover:opacity-80 font-medium">Ver
                            Historial</button>
                    </div>
                </div>
                <div class="ticket-history-container hidden mt-4 pt-4 border-t border-[var(--color-border-muted)]">
                    <div class="ticket-timeline relative pl-6"></div>
                    <div class="mt-4 flex justify-between items-center">
                        <button
                            class="add-ticket-step-btn text-sm bg-sky-500/20 hover:bg-sky-500/30 text-sky-300 font-semibold py-2 px-3 rounded-lg flex items-center gap-2">
                            <i class="fas fa-plus-circle"></i>
                            A√±adir Paso
                        </button>
                        <button class="delete-ticket-btn text-[var(--color-danger)] hover:opacity-80"
                            title="Eliminar Ticket de Seguimiento">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <template id="timeline-item-template">
            <div class="timeline-item relative pb-6">
                <div
                    class="absolute left-0 w-6 h-6 bg-[var(--color-border-subtle)] rounded-full text-center flex items-center justify-center">
                    <i class="fas text-xs text-[var(--color-text-base)]"></i>
                </div>
                <div class="ml-10 flex flex-col">
                    <div class="flex justify-between items-baseline">
                        <p class="font-semibold text-[var(--color-text-base)] timeline-status"></p>
                        <p class="text-xs text-[var(--color-text-muted)] timeline-date flex-shrink-0 pl-4"></p>
                    </div>
                    <p class="text-sm text-[var(--color-text-base)] mt-1 whitespace-pre-wrap timeline-notes">
                    </p>
                </div>
            </div>
        </template>

        <template id="room-header-template">
            <details class="room-group">
                <summary class="room-header p-2 pt-4 flex justify-between items-center cursor-pointer">
                    <h4 class="font-bold text-[var(--color-text-muted)] text-sm uppercase tracking-wider"></h4>
                    <i
                        class="fas fa-chevron-right accordion-arrow transition-transform text-[var(--color-text-muted)]"></i>
                </summary>
                <div class="item-container pl-2"></div>
            </details>
        </template>

        <template id="item-template">
            <div
                class="sidebar-item p-3 border-b border-[var(--color-border-muted)] cursor-pointer flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 flex-1 truncate">
                    <input type="checkbox" class="selection-checkbox hidden accent-[var(--color-primary)] w-5 h-5">
                    <img class="item-thumbnail flex-shrink-0">
                    <div class="flex-1 truncate">
                        <h3 class="font-semibold text-slate-800 truncate"></h3>
                        <p class="text-sm text-[var(--color-text-muted)] truncate"></p>
                    </div>
                </div>
                <div class="status-dot w-3 h-3 rounded-full ml-auto flex-shrink-0"></div>
            </div>
        </template>

        <template id="report-item-template">
            <div class="bg-[var(--color-bg-base)] p-4 rounded-lg shadow-sm border border-[var(--color-border-muted)]">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-[var(--color-secondary)] report-title flex items-center gap-2">
                            <span class="report-title-text truncate"></span>
                            <span class="report-type-badge hidden text-xs font-medium px-2 py-0.5 rounded-full"></span>
                        </h4>
                        <p class="text-sm text-[var(--color-text-muted)] mt-1">
                            <span class="report-date"></span>
                            - T√©c: <span class="report-technician"></span>
                        </p>
                    </div>
                    <div class="flex items-end justify-end gap-3 flex-shrink-0 flex-wrap w-full sm:w-auto mt-2 sm:mt-0">
                        <div class="report-attachments-list flex flex-col gap-2 items-end"></div>
                        <button
                            class="toggle-details-btn text-sm text-[var(--color-primary)] hover:opacity-80 font-medium">Ver
                            detalles</button>
                        <button class="delete-report-btn text-[var(--color-danger)] hover:opacity-80"
                            aria-label="Eliminar">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="report-findings-container hidden mt-3 pt-3 border-t border-[var(--color-border-muted)]">
                    <p class="text-sm font-semibold text-[var(--color-text-base)] mb-1">Observaciones:</p>
                    <p class="text-[var(--color-text-base)] whitespace-pre-wrap report-findings"></p>
                </div>
            </div>
        </template>

        <template id="room-management-item-template">
            <div class="flex justify-between items-center bg-[var(--color-bg-muted)] p-3 rounded-lg">
                <span class="room-name text-[var(--color-text-base)] truncate"></span>
                <button class="delete-room-btn text-[var(--color-danger)] hover:opacity-80 flex-shrink-0">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </template>

        <template id="batch-list-item-template">
            <div
                class="batch-item-trigger flex justify-between items-center bg-[var(--color-bg-muted)] p-3 rounded-lg cursor-pointer hover:bg-white">
                <div class="min-w-0">
                    <p class="font-semibold text-white batch-name truncate"></p>
                    <p class="text-sm text-[var(--color-text-muted)] batch-item-count"></p>
                </div>
                <span class="batch-status-badge text-xs font-medium px-2 py-0.5 rounded-full flex-shrink-0"></span>
            </div>
        </template>

        <template id="batch-pipette-item-template">
            <div class="flex justify-between items-center bg-[var(--color-bg-muted)] p-3 rounded-lg">
                <div>
                    <p class="font-semibold text-white item-name"></p>
                    <p class="text-sm text-[var(--color-text-muted)] item-details"></p>
                </div>
                <button class="remove-from-batch-btn text-[var(--color-danger)] hover:opacity-80"
                    aria-label="Quitar del lote" title="Quitar del Lote">
                    <i class="fas fa-times-circle"></i>
                </button>
            </div>
        </template>

        <div id="toast-container" class="fixed top-5 right-5 z-[100] space-y-2"></div>

        </div>
        </div>
        <div id="modal-qr-generado"
            class="hidden fixed inset-0 w-full h-full bg-black/95 z-[70] flex flex-col items-center justify-center">
            <div class="bg-slate-900 p-5 rounded-2xl w-[95%] max-w-[400px] border border-slate-700 shadow-2xl relative">

                <h3
                    class="text-white text-center mb-4 font-bold text-lg flex items-center justify-center gap-2 font-sans">
                    üì∑ Escaneando...
                </h3>

                <div id="reader-box"
                    class="w-full h-[300px] bg-black rounded-xl overflow-hidden relative border border-slate-600">
                    <div
                        class="absolute top-1/2 left-[10%] right-[10%] h-0.5 bg-red-500 shadow-[0_0_4px_red] opacity-70">
                    </div>
                </div>

                <p class="text-slate-400 text-center mt-4 text-xs font-sans">
                    Buscando N¬∞ de Serie o ID Interno...
                </p>

                <button onclick="window.cerrarScannerUniversal()"
                    class="mt-4 w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-colors text-sm cursor-pointer">
                    CANCELAR
                </button>
            </div>
        </div>

        <div id="print-selection-modal"
            class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-[60] backdrop-blur-sm">
            <div
                class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100 border border-slate-200">

                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">Centro de Impresi√≥n</h3>
                        <p class="text-xs text-slate-500">Selecciona categor√≠a</p>
                    </div>
                    <button type="button" onclick="window.closePrintModal()" aria-label="Cerrar modal"
                        class="text-slate-400 hover:text-red-500 transition-colors w-8 h-8 flex items-center justify-center rounded-full">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <div class="p-6 grid grid-cols-1 gap-4">
                    <button onclick="window.fetchAndPrintByCategory('equipment')"
                        class="group flex items-center gap-4 p-4 border border-slate-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left shadow-sm hover:shadow-md cursor-pointer">
                        <div
                            class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xl group-hover:scale-110 transition-transform">
                            <i class="fas fa-microscope"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-700">Equipos Generales</h4>
                        </div>
                    </button>

                    <button onclick="window.fetchAndPrintByCategory('pipettes')"
                        class="group flex items-center gap-4 p-4 border border-slate-200 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-all text-left shadow-sm hover:shadow-md cursor-pointer">
                        <div
                            class="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xl group-hover:scale-110 transition-transform">
                            <i class="fas fa-eye-dropper"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-700">Pipetas</h4>
                        </div>
                    </button>

                    <button onclick="window.fetchAndPrintByCategory('refrigerators')"
                        class="group flex items-center gap-4 p-4 border border-slate-200 rounded-lg hover:border-sky-500 hover:bg-sky-50 transition-all text-left shadow-sm hover:shadow-md cursor-pointer">
                        <div
                            class="w-12 h-12 rounded-full bg-sky-100 text-sky-600 flex items-center justify-center text-xl group-hover:scale-110 transition-transform">
                            <i class="fas fa-snowflake"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-700">Refrigeraci√≥n</h4>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div id="delete-security-modal"
            class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-[60] p-4">
            <div
                class="bg-slate-800 rounded-xl border border-red-500/30 shadow-2xl w-full max-w-md p-6 relative overflow-hidden">
                <div
                    class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent">
                </div>

                <div class="text-center">
                    <div class="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-lock text-red-500 text-2xl"></i>
                    </div>

                    <h3 class="text-xl font-bold text-white mb-2">Acceso Restringido</h3>
                    <p class="text-slate-400 text-sm mb-6">Esta acci√≥n es irreversible. Ingrese la clave para
                        confirmar.</p>

                    <div class="space-y-4">
                        <input type="password" id="delete-auth-password"
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white text-center tracking-widest text-lg focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all outline-none"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">

                        <p id="delete-error-msg" class="text-red-400 text-xs hidden font-bold animate-pulse">
                            <i class="fas fa-exclamation-triangle mr-1"></i> Clave incorrecta
                        </p>

                        <div class="flex gap-3 pt-2">
                            <button onclick="window.closeDeleteModal()"
                                class="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-200 py-2.5 rounded-lg transition-colors font-medium">
                                Cancelar
                            </button>
                            <button onclick="window.confirmDeleteWithPassword()"
                                class="flex-1 bg-red-600 hover:bg-red-500 text-white py-2.5 rounded-lg transition-colors font-bold shadow-lg shadow-red-900/20">
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="module" src="firebase-init.js"></script>
        <script type="module" src="app.js"></script>

    </body>

</html>